<?php
require_once('vendor/autoload.php');
use Firebase\JWT\JWT;
use Firebase\JWT\Key;
http_response_code(403);
$text = "Не стоит выполнять, нелегетимные запросы";
$id = 1;//ID ПОЛЬЗОВАТЕЛЯ
// досрочно снять можно только через тех поддержку. или смену пароля. соотвественно нужен счётчик и поле блокировки.
if(isset($_GET['code']) and isset($_GET['id']) and isset($_GET['hash'])){
	//проверки входных данных.
	//сравнить ip; сравнить id = с id из кэша. hash использовать как ключ
	//каждое поле,проверка на инъекцию или js.
}
else{
	require_once('core.php');
	
	$payload = ['iss' => $iss,
	 'sub' => $sub,
	 'aud' => $aud,
	 'jti' => $jti,
	 'usd' => $usd,
	 'iat' => $iat,
	 'nbf' => $nbf,
	 'exp' => $exp
	];

$jwt = JWT::encode($payload, $key, 'HS512');
$decoded=decode_jwt($jwt,$key);

print_r($decoded);

$decoded_array = (array) $decoded;

sleep(1);
$decoded=decode_jwt($jwt,$key);
	echo $text;
	print_r($decoded);
	exit;
}
?>